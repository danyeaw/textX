<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Igor DejanoviÄ‡">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Multi meta-model - textX</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../style.css" rel="stylesheet">
  <link href="../css/version-select.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Multi meta-model";
    var mkdocs_page_input_path = "multimetamodel.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68681917-1', 'igordejanovic.net');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> textX</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../grammar/">Grammar</a>
                </li>
                <li class="">
                    
    <a class="" href="../metamodel/">Meta-model</a>
                </li>
                <li class="">
                    
    <a class="" href="../model/">Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../scoping/">Scoping</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Multi meta-model</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#multi-meta-model-support">Multi meta-model support</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#use-case-meta-model-referencing-another-meta-model">Use Case: meta model referencing another meta model</a></li>
        
            <li><a class="toctree-l4" href="#use-case-recipes-and-ingredients-with-global-model-sharing">Use Case: Recipes and Ingredients with global model sharing</a></li>
        
            <li><a class="toctree-l4" href="#use-case-meta-model-sharing-with-the-importuri-feature">Use Case: meta model sharing with the ImportURI-feature</a></li>
        
            <li><a class="toctree-l4" href="#use-case-referencing-non-textx-meta-modelsmodels">Use Case: referencing non-textx meta-models/models</a></li>
        
            <li><a class="toctree-l4" href="#conclusion">Conclusion</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../parser_config/">Parser configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../visualization/">Visualization</a>
                </li>
                <li class="">
                    
    <a class="" href="../error_handling/">Error handling</a>
                </li>
                <li class="">
                    
    <a class="" href="../debugging/">Debugging</a>
                </li>
                <li class="">
                    
    <a class="" href="../textx_command/">textx command</a>
                </li>
                <li class="">
                    
    <a class="" href="../howto/">Howtos</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../tutorials/hello_world/">Hello World</a>
                </li>
                <li class="">
                    
    <a class="" href="../tutorials/robot/">Robot</a>
                </li>
                <li class="">
                    
    <a class="" href="../tutorials/entity/">Entity</a>
                </li>
                <li class="">
                    
    <a class="" href="../tutorials/state_machine/">State Machine</a>
                </li>
                <li class="">
                    
    <a class="" href="../tutorials/toylanguage/">Toy language compiler</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">About</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../about/comparison/">Comparison</a>
                </li>
                <li class="">
                    
    <a class="" href="../about/discuss/">Discuss</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/igordejanovic/textX/blob/master/CONTRIBUTING.md">Contributing</a>
                </li>
                <li class="">
                    
    <a class="" href="https://github.com/igordejanovic/textX/blob/master/LICENSE.txt">License</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">What's new</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../whatsnew/release_1_5/">Release 1.5</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">textX</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>User Guide &raquo;</li>
        
      
    
    <li>Multi meta-model</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/igordejanovic/textX/edit/master/docs/multimetamodel.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="multi-meta-model-support">Multi meta-model support<a class="headerlink" href="#multi-meta-model-support" title="Permanent link">&para;</a></h1>
<p>As a feature of some <a href="../scoping/">scope providers</a>, there is the possibility to
define a file extension based allocation of model files to meta models. This
global data is stored in the class <code>textx.scoping.MetaModelProvider</code>: Here, you
can register meta models associated to files patterns. Thus, you can control
which meta model to use when loading a file in a scope provider using the
<code>ImportURI</code>-feature (e.g., <code>FQNImportURI</code>) or with global scope providers (e.g.,
<code>PlainNameGlobalRepo</code>). If no file pattern matches, the meta model of the current
model is utilized.</p>
<p>There are different ways to combine meta models: <strong>(1)</strong> a meta model can use 
another meta model to compose its own structures (extending a meta model) 
or <strong>(2)</strong> a meta model can reference elements from another meta model.</p>
<p><strong>Extending an existing meta model</strong> can be realized in TextX by defining 
a grammar extending an existing grammar. All user classes, scope providers 
and processors must be manually added to the new meta model. Such extended 
meta models can also reference elements of models created with the original 
meta model. Although the meta classes corresponding to inherited rules are 
redefined by the extending meta model, scope providers match the object 
types correctly. This is implemented by comparing the types by their name 
(see textx.scoping.tool.textx_isinstance). Simple examples: see 
<a href="https://github.com/igordejanovic/textX/tree/master/tests/functional/test_scoping">tests/functional/test_scoping/test_metamodel_provider*.py</a>.</p>
<p><strong>Referencing elements from another meta model</strong> can be achieved without 
having the original grammar, nor any other details like scope providers, etc. 
Such references can, thus, be enabled while having access only to the 
meta model object of the meta model to be referenced. This object may 
originate from a library installed on the system (without sources, like 
the grammar). The meta model to be referenced is passed to the referencing 
meta model while constructing it. The referencing grammar can then reference 
the types (rules) of the referenced meta model. Rule lookup takes care of 
choosing the correct types. Simple examples: see 
<a href="https://github.com/igordejanovic/textX/tree/master/tests/functional/test_metamodel/test_multi_metamodel_refs.py">tests/functional/test_metamodel/test_multi_metamodel_refs.py</a>.</p>
<p>Thus, when designing a domain model (e.g., from the software test domain) to 
reference elements of another domain model (e.g., from the 
interface/communication domain), the second possibility (referencing) 
is probably a cleaner way to achieve the task than the first possibility 
(extending).</p>
<h2 id="use-case-meta-model-referencing-another-meta-model">Use Case: meta model referencing another meta model<a class="headerlink" href="#use-case-meta-model-referencing-another-meta-model" title="Permanent link">&para;</a></h2>
<p>We have two grammars (grammar A nd B). "grammarA" defines named elements of 
type A:</p>
<pre><code>Model: a+=A;
A:'A' name=ID;
</code></pre>
<p>"GrammarBWithImportURI" defines named elements of type B referencing elements
of type A (from "grammarA"). It also allows importing other model files.</p>
<pre><code>Model: imports+=Import b+=B;
B:'B' name=ID '-&gt;' a=[A];
Import: 'import' importURI=STRING;
</code></pre>
<p>Here, we create two meta models, where
the second meta model allows referencing the first one
(<strong>referenced_metamodels=[mm_A]</strong>).</p>
<pre><code>mm_A = metamodel_from_str(grammarA)
mm_B = metamodel_from_str(grammarBWithImport,
                          referenced_metamodels=[mm_A])
</code></pre>
<p>Then we define a default scope provider supporting the importURI-feature:</p>
<pre><code>mm_B.register_scope_providers({"*.*": scoping_providers.FQNImportURI()})
</code></pre>
<p>and we map file endings to the meta models:</p>
<pre><code>scoping.MetaModelProvider.add_metamodel("*.a", mm_A)
scoping.MetaModelProvider.add_metamodel("*.b", mm_B)
</code></pre>
<p>Full example (also with a globally shared repository discussion): see 
<a href="https://github.com/igordejanovic/textX/tree/master/tests/test_metamodel/test_multi_metamodel_refs.py">tests/test_metamodel/test_multi_metamodel_refs.py</a>.</p>
<h2 id="use-case-recipes-and-ingredients-with-global-model-sharing">Use Case: Recipes and Ingredients with global model sharing<a class="headerlink" href="#use-case-recipes-and-ingredients-with-global-model-sharing" title="Permanent link">&para;</a></h2>
<p>In this use case we define recipes (food preparation) including a list of
ingredients. The ingredients of a recipe model element are defined by</p>
<ul>
<li>a count (e.g. 100),</li>
<li>a unit (e.g. gram),</li>
<li>and an ingredient reference (e.g. sugar).</li>
</ul>
<p>In a separate model the ingredients are defined: Here we can define multiple
units to be used for each ingerdient (e.g. <code>60 gram of sugar</code> or <code>1 cup of
sugar</code>). Moreover some ingredients may inherit features of other ingredients
(e.g. salt may have the same units as sugar).</p>
<p>Here, two meta models are defined to handle ingredient definitions (e.g.
<code>fruits.ingredient</code>) and recipes (e.g. <code>fruit_salad.recipe</code>).</p>
<p>The <code>MetaModelProvider</code> is utilized to allocate the file extensions to the meta
models
(see
<a href="https://github.com/igordejanovic/textX/blob/master/tests/functional/test_scoping/test_metamodel_provider2.py">test_metamodel_provider2.py</a>).
Importantly, a common model repository (<code>global_repo</code>) is defined to share all
model elements among both meta models:</p>
<pre><code>i_mm = get_meta_model(
    global_repo, this_folder + "/metamodel_provider2/Ingredient.tx")
r_mm = get_meta_model(
    global_repo, this_folder + "/metamodel_provider2/Recipe.tx")

scoping.MetaModelProvider.add_metamodel("*.recipe", r_mm)
scoping.MetaModelProvider.add_metamodel("*.ingredient", i_mm)
</code></pre>
<h2 id="use-case-meta-model-sharing-with-the-importuri-feature">Use Case: meta model sharing with the ImportURI-feature<a class="headerlink" href="#use-case-meta-model-sharing-with-the-importuri-feature" title="Permanent link">&para;</a></h2>
<p>In this use case we have a given meta model to define components and instances
of components. A second model is added to define users to use instances of such
components defned in the first model.</p>
<p>The grammar for the user meta-model is given as follows (including the ability
to import a component model file).</p>
<pre><code>import Components

Model:
    imports+=Import
    users+=User
;

User:
    "user" name=ID "uses" instance=[Instance|FQN] // Instance, FQN from other grammar
;

Import: 'import' importURI=STRING;
</code></pre>
<p>The global <code>MetaModelProvider</code> class is utilized to allocate the file extension to
the corresponding meta model:</p>
<pre><code>    scoping.MetaModelProvider.add_metamodel("*.components", mm_components)
    scoping.MetaModelProvider.add_metamodel("*.users", mm_users)
</code></pre>
<p>With this construct we can define a user model referencing a component model:</p>
<pre><code>import "example.components"
user pi uses usage.action1
</code></pre>
<h2 id="use-case-referencing-non-textx-meta-modelsmodels">Use Case: referencing non-textx meta-models/models<a class="headerlink" href="#use-case-referencing-non-textx-meta-modelsmodels" title="Permanent link">&para;</a></h2>
<p>You can reference an arbitrary python object using the <code>OBJECT</code> rule (see:
<a href="https://github.com/igordejanovic/textX/blob/master/tests/functional/test_scoping/test_reference_to_buildin_attribute.py">test_reference_to_buildin_attribute.py</a>)</p>
<pre><code>Access:
    'access' name=ID pyobj=[OBJECT] ('.' pyattr=[OBJECT])?
</code></pre>
<p>In this case the referenced object is a python dictionary (<code>pyobj</code>) and the
entry of such a dictionary (<code>pyattr</code>). An example model will look like:</p>
<pre><code>access AccessName1 foreign_model.name_of_entry
</code></pre>
<p>A custom scope provider is used to achieve this mapping:</p>
<pre><code>def my_scope_provider(obj, attr, attr_ref):
    pyobj = obj.pyobj
    if attr_ref.obj_name in pyobj:
        return pyobj[attr_ref.obj_name]
    else:
        raise Exception("{} not found".format(attr_ref.obj_name))
</code></pre>
<p>The scope provider is linked to the <code>pyattr</code> attribute of the rule <code>Access</code>:</p>
<pre><code>my_metamodel.register_scope_providers({
    "Access.pyattr": my_scope_provider,
})
</code></pre>
<p>With this, we can reference non-textx data elements from within our language.
This can be used to, e.g., use a non-textx AST object and reference it from a
textx model.</p>
<h3 id="referencing-non-textx-meta-modelsmodels-with-a-json-file">Referencing non-textx meta-models/models with a json file<a class="headerlink" href="#referencing-non-textx-meta-modelsmodels-with-a-json-file" title="Permanent link">&para;</a></h3>
<p>In
<a href="https://github.com/igordejanovic/textX/blob/master/tests/functional/test_scoping/test_reference_to_nontextx_attribute.py">test_reference_to_nontextx_attribute.py</a> we
also demonstrate how such an external model can be loaded with our own language
(using a json file as external model).</p>
<pre><code>import "test_reference_to_nontextx_attribute/othermodel.json" as data
access A1 data.name
access A2 data.gender
</code></pre>
<p>Where the json file <code>othermodel.json</code> consists of:</p>
<pre><code>{
  "name": "pierre",
  "gender": "male"
}
</code></pre>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>We provide a pragmatic way to define meta-models using other meta models.
Mostly, we focus on textx meta-models using other textx meta-models. But scope
providers may be used to also link a textx meta model to an arbitrary non-textx
data structure. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../parser_config/" class="btn btn-neutral float-right" title="Parser configuration">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../scoping/" class="btn btn-neutral" title="Scoping"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; <a href="http://igordejanovic.net/">Igor DejanoviÄ‡</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/igordejanovic/textX/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../scoping/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../parser_config/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../js/version-select.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
